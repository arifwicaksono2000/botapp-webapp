<!DOCTYPE html>
<html>
<head>
    <title>Trades Dashboard</title>
</head>
<body>
    <h1>Active Trades</h1>

    <form method="post" action="{% url 'start_trade' %}">
        {% csrf_token %}
        <select name="side">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
        </select>
        <input type="number" name="volume" placeholder="Volume (1000 = 0.01 lot)" required>
        <input type="number" name="hold" placeholder="Hold (seconds)" required>
        <button type="submit">▶️ Start New Trade</button>
    </form>

    <hr>

    <table border="1">
        <tr>
            <th>Trade ID</th>
            <th>Side</th>
            <th>Volume</th>
            <th>Hold (seconds)</th>
            <th>Status</th>
            <th>PID</th>
        </tr>
        {% for trade_id, trade in trades.items %}
        <tr id="trade-{{ trade_id }}">
            <td>{{ trade_id }}</td>
            <td>{{ trade.side }}</td>
            <td>{{ trade.volume }}</td>
            <td>{{ trade.hold }}</td>
            <td class="status">{{ trade.status }}</td>
            <td>{{ trade.pid }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="6">No active trades.</td></tr>
        {% endfor %}
    </table>

    <script>
        const socket = new WebSocket(`ws://${window.location.host}/ws/bot/status/`);
        socket.onmessage = ({ data }) => {
          const trades = JSON.parse(data);
          for (const [id, info] of Object.entries(trades)) {
            const row = document.getElementById(`trade-${id}`);
            if (row) {
              row.querySelector('.status').innerText = info.status;
            }
          }
        };
        socket.onclose = () => console.warn('WebSocket closed');
      </script>
      
        

</body>
</html>
